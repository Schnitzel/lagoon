- name: "{{ testname }} - POST api deployEnvironmentPromote with source environment {{ source_environment }}, target environment {{ promote_environment }} and project {{ project }} to {{ lookup('env','API_PROTOCOL') }}://{{ lookup('env','API_HOST') }}:{{ lookup('env','API_PORT') }}/graphql"
  uri:
    url: "{{ lookup('env','API_PROTOCOL') }}://{{ lookup('env','API_HOST') }}:{{ lookup('env','API_PORT') }}/graphql"
    method: POST
    headers:
      Authorization: "Bearer {{ token.stdout }}"
    body_format: json
    body: '{ "query": "mutation($branchName: String!, $projectName: String!, $sourceEnvironmentName: String!) {deployEnvironmentPromote(input:{branchName:$branchName,project:{name:$projectName},sourceEnvironment:{name:$sourceEnvironmentName,project:{name:$projectName}}})}", "variables": {"branchName":"{{ source_environment }}","sourceEnvironmentName":"{{ promote_environment }}","projectName":"{{ project }}"}}'
